!function(){var t={base_url:"http://localhost:3000",hideModals:function(){const t=document.querySelectorAll(".modal");for(const e of t)e.classList.remove("is-active")}};const e={makeTagInDOM:function(t){const o=document.createElement("span");o.dataset.tagId=t.id,o.textContent=t.name,o.style.backgroundColor=t.color,o.classList.add("tag"),o.addEventListener("dblclick",e.dissociateTagFromCard),console.log(o),document.querySelector(`.box[data-card-id="${t.card_has_tag.card_id}"]`).querySelector(".tags").appendChild(o)},dissociateTagFromCard:async function(e){const o=e.target.closest(".box").dataset.cardId,a=e.target.dataset.tagId;try{const r=await fetch(`${t.base_url}/cards/${o}/tags/${a}`,{method:"DELETE"}),s=await r.json();if(!r.ok)throw s;e.target.remove()}catch(r){console.log(jsonData),alert("Impossible de dissocier le tag de cette carte !")}},showAssociateTagModal:async function(e){const o=e.target.closest(".box").dataset.cardId;console.log(o);const a=document.querySelector("#associateTagModal");a.querySelector('input[name="card_id"]').value=o;const r=a.querySelector('select[name="tag_id"]');r.textContent="";try{const e=await fetch(t.base_url+"/tags"),o=await e.json();if(!e.ok)throw o;for(const t of o){const e=document.createElement("option");e.textContent=t.name,e.value=t.id,r.appendChild(e)}}catch(s){console.log(s),alert("Impossible d'ajouter ce tag")}a.classList.add("is-active")},associateTagToCard:async function(o){o.preventDefault();const a=new FormData(o.target);try{const o=await fetch(`${t.base_url}/cards/${a.get("card_id")}/tags`,{method:"POST",body:a}),r=await o.json();if(console.log(r),!o.ok)throw r;const s=r.tags.find(t=>t.id==a.get("tag_id"));e.makeTagInDOM(s)}catch(r){console.log(r)}t.hideModals()}};var o=e;const a={showAddCardModal:function(t){const e=t.target.closest(".panel").dataset.listId,o=document.getElementById("addCardModal");o.querySelector('input[name="list_id"]').value=e,o.classList.add("is-active")},handleAddCardForm:async function(e){e.preventDefault();const o=new FormData(e.target);try{const e=await fetch(t.base_url+"/cards",{method:"POST",body:o}),r=await e.json();if(!e.ok)throw new Error("Impossible de cr\xe9er la carte !");a.makeCardInDOM(r)}catch(r){alert(r),console.log(r)}t.hideModals(),e.target.reset()},makeCardInDOM:function(t){const e=document.getElementById("template-card"),r=document.importNode(e.content,!0);r.querySelector(".card-name").textContent=t.title,r.querySelector(".box"),r.querySelector(".box").dataset.cardId=t.id,r.querySelector("form input[name='card-id']").value=t.id,r.querySelector(".box").style.backgroundColor=t.color,r.querySelector('input[name="color"]').value=t.color,r.querySelector(".edit-card-icon").addEventListener("click",a.showEditCardForm),r.querySelector(".edit-card-form").addEventListener("submit",a.handleEditCardForm),r.querySelector(".delete-card-icon").addEventListener("click",a.deleteCard),r.querySelector(".associate-tag-icon").addEventListener("click",o.showAssociateTagModal),document.querySelector(`[data-list-id="${t.list_id}"]`).querySelector(".panel-block").appendChild(r)},showEditCardForm:function(t){const e=t.target.closest(".box");e.querySelector(".card-name").classList.add("is-hidden"),e.querySelector(".edit-card-form").classList.remove("is-hidden")},handleEditCardForm:async function(e){e.preventDefault();const o=new FormData(e.target),a=e.target.previousElementSibling;try{const r=await fetch(`${t.base_url}/cards/${o.get("card-id")}`,{method:"PUT",body:o}),s=await r.json();if(!r.ok)throw new Error("Impossible d'\xe9diter la carte !");a.textContent=s.title,e.target.closest(".box").style.backgroundColor=s.color}catch(r){console.log(r),alert(r)}e.target.classList.add("is-hidden"),a.classList.remove("is-hidden")},deleteCard:async function(e){const o=e.target.closest(".box");try{const e=await fetch(`${t.base_url}/cards/${o.dataset.cardId}`,{method:"DELETE"});if(await e.json(),!e.ok)throw new Error("Impossible de supprimer la carte !");o.remove()}catch(a){console.log(a),alert(a)}},handleDragCard:function(t){const e=t.from,o=t.to;let r=e.querySelectorAll(".box");if(a.updateAllCards(r),e===o)return;const s=o.closest(".panel").dataset.listId;r=o.querySelectorAll(".box"),a.updateAllCards(r,s)},updateAllCards:function(e,o=null){e.forEach(async(e,a)=>{const r=new FormData;r.set("position",a),o&&r.set("list_id",o);try{const o=await fetch(`${t.base_url}/cards/${e.dataset.cardId}`,{method:"PUT",body:r}),a=await o.json();if(!o.ok)throw a}catch(s){console.log(s),alert(s)}})}};var r=a;const s={showAddListModal:function(){document.getElementById("addListModal").classList.add("is-active")},handleAddListForm:async function(e){e.preventDefault();const o=new FormData(e.target);try{const e=await fetch(t.base_url+"/lists",{method:"POST",body:o}),a=await e.json();if(!e.ok)throw new Error("Impossible de cr\xe9er la liste !");s.makeListInDOM(a)}catch(a){alert(a),console.log(a)}t.hideModals(),e.target.reset()},makeListInDOM:function(t){const e=document.getElementById("list-template"),o=document.importNode(e.content,!0);o.querySelector("h2").textContent=t.name,o.querySelector(".panel").dataset.listId=t.id,o.querySelector("form input[name='list-id']").value=t.id,o.querySelector(".button--add-card").addEventListener("click",r.showAddCardModal),o.querySelector("h2").addEventListener("dblclick",s.showEditListForm),o.querySelector(".edit-list-form").addEventListener("submit",s.handleEditListForm),o.querySelector(".button--delete-list").addEventListener("click",s.deleteList);const a=o.querySelector(".panel-block");Sortable.create(a,{group:"list",draggable:".box",onEnd:r.handleDragCard});const n=document.querySelector("#listContainer");n.querySelector(".panel"),n.appendChild(o)},showEditListForm:function(t){t.target.classList.add("is-hidden"),t.target.nextElementSibling.classList.remove("is-hidden")},handleEditListForm:async function(e){e.preventDefault();const o=new FormData(e.target),a=e.target.previousElementSibling;try{const e=await fetch(`${t.base_url}/lists/${o.get("list-id")}`,{method:"PUT",body:o}),r=await e.json();if(!e.ok)throw new Error("Impossible d'\xe9diter la liste !");a.textContent=r.name}catch(r){console.log(r),alert(r)}e.target.classList.add("is-hidden"),a.classList.remove("is-hidden")},deleteList:async function(e){if(!confirm("Voulez-vous vraiment supprimer cette liste ?"))return;const o=e.target.closest(".panel");try{const e=await fetch(`${t.base_url}/lists/${o.dataset.listId}`,{method:"DELETE"});if(await e.json(),!e.ok)throw new Error("Impossible de supprimer la liste !");o.remove()}catch(a){console.log(a),alert(a)}},handleDragList:function(e){document.querySelectorAll(".panel").forEach(async(e,o)=>{const a=new FormData;a.set("position",o);try{const o=await fetch(`${t.base_url}/lists/${e.dataset.listId}`,{method:"PUT",body:a}),r=await o.json();if(!o.ok)throw r}catch(r){console.log(jsonData),alert("Impossible de mettre \xe0 jour la liste !")}})}};var n=s,d={init:function(){console.log("app.init !"),d.addListenerToActions(),d.getListsFromAPI()},addListenerToActions:function(){document.getElementById("addListButton").addEventListener("click",n.showAddListModal);const e=document.querySelectorAll(".close");for(const o of e)o.addEventListener("click",t.hideModals);document.querySelector("#addListModal form").addEventListener("submit",n.handleAddListForm);const a=document.querySelectorAll(".button--add-card");for(const t of a)t.addEventListener("click",r.showAddCardModal);document.querySelector("#addCardModal form").addEventListener("submit",r.handleAddCardForm),document.querySelector("#associateTagModal form").addEventListener("submit",o.associateTagToCard)},getListsFromAPI:async function(){const e=await fetch(t.base_url+"/lists"),a=await e.json();if(!e.ok)throw new Error("Un probl\xe8me est survenu sur la requ\xeate HTTP !");console.table(a);for(const t of a){n.makeListInDOM(t);for(const e of t.cards){r.makeCardInDOM(e);for(const t of e.tags)o.makeTagInDOM(t)}}const s=document.querySelector(".card-lists");Sortable.create(s,{draggable:".panel",onEnd:n.handleDragList})}};document.addEventListener("DOMContentLoaded",d.init)}();